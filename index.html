<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiosk Poster System</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    
    <style>
        /* 키오스크 전체 화면 최적화 */
        html, body {
            position: relative;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* 스크롤바 절대 방지 */
            background-color: #000;
        }

        .swiper {
            width: 100%;
            height: 100%;
        }

        .swiper-slide {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        .swiper-slide img,
        .swiper-slide video {
            /* 이미지/영상이 작게 보이지 않도록 화면에 꽉 채우는 설정 */
            width: 100%;
            height: 100%;
            /* 포스터 비율에 맞춰 왜곡 없이 채우려면 cover, 
               약간의 왜곡이 있어도 전체를 다 보여주려면 fill을 사용하세요. */
            object-fit: contain; 
        }
        
        .swiper-slide video {
            display: block;
        }

        /* 하단 페이지네이션(점) 디자인 개선 - 키오스크 가독성용 */
        .swiper-pagination-bullet {
            width: 16px;
            height: 16px;
            background: #fff;
            opacity: 0.5;
            margin: 0 10px !important;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
        .swiper-pagination-bullet-active {
            background: #007aff;
            opacity: 1;
            transform: scale(1.2);
        }
    </style>
</head>
<body>

    <div class="swiper mySwiper">
        <div class="swiper-wrapper" id="poster-wrapper"></div>
        
        <div class="swiper-pagination"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script>
        /**
         * 1. 설정 변수
         * imageCount: 체크할 최대 파일 번호 (예: 20이면 01~20까지 검사)
         * extensions: 허용할 이미지 확장자 (대소문자 구분 대응)
         */
        const imageCount = 20; 
        const imageFolder = "upload";
        const imageExtensions = ["png", "jpg", "jpeg", "gif", "PNG", "JPG", "JPEG", "GIF"];
        const videoExtensions = ["mp4", "MP4", "mov", "MOV", "webm", "WEBM"];
        const allExtensions = [...imageExtensions, ...videoExtensions];
        const wrapper = document.getElementById('poster-wrapper');
        
        // 슬라이드 메타데이터 저장 (타입, 경로, 길이)
        const slideMetadata = [];
        
        // Swiper 설정값 (setup.json에서 로드)
        let swiperConfig = null;
        let swiperInstance = null;
        
        // 모니터링 및 복구를 위한 전역 변수
        let autoplayMonitorInterval = null;
        let slideChangeMonitorInterval = null;
        let lastSlideChangeTime = Date.now();
        let videoPlayTimeout = null;
        let videoEndCheckInterval = null;

        // setup.json 파일 로드
        async function loadSwiperConfig() {
            try {
                // 캐시 방지를 위해 타임스탬프 추가
                const cacheBuster = '?t=' + new Date().getTime();
                const response = await fetch('./setup.json' + cacheBuster);
                if (response.ok) {
                    const loadedConfig = await response.json();
                    console.log('setup.json 원본 데이터:', JSON.stringify(loadedConfig, null, 2));
                    console.log('setup.json autoplay.delay:', loadedConfig.autoplay?.delay);
                    
                    swiperConfig = loadedConfig;
                    console.log('setup.json 로드 성공:', swiperConfig);
                } else {
                    // 파일이 없거나 오류 시 기본값 사용
                    swiperConfig = getDefaultConfig();
                    console.warn('setup.json 파일을 찾을 수 없습니다. 기본 설정을 사용합니다.');
                }
            } catch (error) {
                // 파일이 없을 때는 조용히 기본값 사용
                swiperConfig = getDefaultConfig();
                console.warn('setup.json 로드 실패. 기본 설정을 사용합니다:', error.message);
            }
        }

        // 기본 설정값
        function getDefaultConfig() {
            return {
                effect: 'fade',
                speed: 1500,
                autoplay: {
                    delay: 12000,
                    disableOnInteraction: false
                },
                loop: true,
                pagination: {
                    clickable: true
                },
                fadeEffect: {
                    crossFade: true
                }
            };
        }

        // 파일 존재 여부를 확인하고 슬라이드를 생성하는 함수 (이미지/영상 모두 지원)
        async function loadAndRenderPosters() {
            let loadedCount = 0;

            for (let i = 1; i <= imageCount; i++) {
                const fileNameBase = String(i).padStart(2, '0'); // 01, 02...
                
                // 각 번호당 확장자별로 파일이 존재하는지 순차 확인
                let fileFound = false;
                for (const ext of allExtensions) {
                    const filePath = `./${imageFolder}/${fileNameBase}.${ext}`;
                    const fileType = getFileType(ext);
                    
                    if (!fileType) continue;
                    
                    const isFound = await checkFile(filePath, fileType);
                    if (isFound) {
                        let duration = null;
                        
                        // 영상인 경우 길이 가져오기
                        if (fileType === 'video') {
                            duration = await getVideoDuration(filePath);
                        }
                        
                        addSlideToWrapper(filePath, fileType, duration);
                        loadedCount++;
                        fileFound = true;
                        break; // 파일을 찾으면 해당 번호는 종료하고 다음 번호로
                    }
                }
            }

            // 모든 검사가 끝난 후 Swiper 실행
            startSwiper(loadedCount);
        }

        // 파일 타입 판별 함수
        function getFileType(ext) {
            const lowerExt = ext.toLowerCase();
            if (imageExtensions.some(e => e.toLowerCase() === lowerExt)) {
                return 'image';
            } else if (videoExtensions.some(e => e.toLowerCase() === lowerExt)) {
                return 'video';
            }
            return null;
        }

        // 실제 파일이 서버에 있는지 비동기 체크 (이미지/영상 모두 지원) - 8단계: 타임아웃 및 재시도 추가
        function checkFile(url, fileType, retries = 2) {
            return new Promise((resolve) => {
                let timeoutId;
                let resolved = false;
                
                const cleanup = () => {
                    if (timeoutId) clearTimeout(timeoutId);
                };
                
                const check = () => {
                    if (fileType === 'image') {
                        const img = new Image();
                        img.onload = () => {
                            if (!resolved) {
                                resolved = true;
                                cleanup();
                                resolve(true);
                            }
                        };
                        img.onerror = () => {
                            if (!resolved) {
                                resolved = true;
                                cleanup();
                                if (retries > 0) {
                                    // 재시도
                                    setTimeout(() => {
                                        checkFile(url, fileType, retries - 1).then(resolve);
                                    }, 1000);
                                } else {
                                    console.warn('파일 로딩 실패 (재시도 소진):', url);
                                    resolve(false);
                                }
                            }
                        };
                        img.src = url;
                    } else if (fileType === 'video') {
                        const video = document.createElement('video');
                        video.onloadedmetadata = () => {
                            if (!resolved) {
                                resolved = true;
                                cleanup();
                                window.URL.revokeObjectURL(video.src);
                                resolve(true);
                            }
                        };
                        video.onerror = () => {
                            if (!resolved) {
                                resolved = true;
                                cleanup();
                                window.URL.revokeObjectURL(video.src);
                                if (retries > 0) {
                                    // 재시도
                                    setTimeout(() => {
                                        checkFile(url, fileType, retries - 1).then(resolve);
                                    }, 1000);
                                } else {
                                    console.warn('파일 로딩 실패 (재시도 소진):', url);
                                    resolve(false);
                                }
                            }
                        };
                        video.src = url;
                    } else {
                        resolve(false);
                    }
                    
                    // 5초 타임아웃
                    timeoutId = setTimeout(() => {
                        if (!resolved) {
                            resolved = true;
                            cleanup();
                            if (retries > 0) {
                                // 재시도
                                setTimeout(() => {
                                    checkFile(url, fileType, retries - 1).then(resolve);
                                }, 1000);
                            } else {
                                console.warn('파일 로딩 타임아웃:', url);
                                resolve(false);
                            }
                        }
                    }, 5000);
                };
                
                check();
            });
        }

        // 영상 길이(초) 가져오는 함수
        function getVideoDuration(url) {
            return new Promise((resolve) => {
                const video = document.createElement('video');
                video.preload = 'metadata';
                video.onloadedmetadata = () => {
                    window.URL.revokeObjectURL(video.src);
                    resolve(video.duration || 5); // 기본값 5초
                };
                video.onerror = () => {
                    window.URL.revokeObjectURL(video.src);
                    resolve(5); // 실패 시 기본값 5초
                };
                video.src = url;
            });
        }

        // 비디오 재생 시도 함수 (재시도 로직 포함)
        async function playVideoWithRetry(video, maxRetries = 2) {
            for (let attempt = 0; attempt <= maxRetries; attempt++) {
                try {
                    await video.play();
                    console.log('비디오 재생 성공:', video.src);
                    return true;
                } catch (error) {
                    console.warn(`비디오 재생 실패 (시도 ${attempt + 1}/${maxRetries + 1}):`, error);
                    if (attempt < maxRetries) {
                        await new Promise(resolve => setTimeout(resolve, 500)); // 0.5초 대기 후 재시도
                    } else {
                        console.error('비디오 재생 최종 실패, 다음 슬라이드로 이동:', video.src);
                        return false;
                    }
                }
            }
            return false;
        }

        // 슬라이드 HTML 추가 (이미지/영상 구분)
        function addSlideToWrapper(path, fileType, duration = null) {
            const slide = document.createElement('div');
            slide.className = 'swiper-slide';
            
            if (fileType === 'image') {
                const img = document.createElement('img');
                img.src = path;
                img.alt = "Kiosk Poster";
                slide.appendChild(img);
            } else if (fileType === 'video') {
                const video = document.createElement('video');
                video.src = path;
                video.autoplay = true;
                video.muted = true;
                video.loop = false;
                video.playsInline = true;
                video.controls = false;
                video.preload = 'none'; // 5단계: 리소스 최적화 - 필요할 때만 로드
                slide.appendChild(video);
                
                // 비디오 에러 처리
                video.addEventListener('error', (e) => {
                    console.error('비디오 에러 발생:', path, e);
                    if (swiperInstance) {
                        setTimeout(() => {
                            swiperInstance.slideNext();
                        }, 1000);
                    }
                });
                
                // 영상 재생 완료 시 다음 슬라이드로 이동
                video.addEventListener('ended', () => {
                    console.log('비디오 재생 완료:', path);
                    if (swiperInstance) {
                        swiperInstance.slideNext();
                    }
                });
            }
            
            // 메타데이터 저장
            slideMetadata.push({
                type: fileType,
                path: path,
                duration: duration
            });
            
            wrapper.appendChild(slide);
        }

        // Swiper 초기화 설정
        function startSwiper(count) {
            if (count === 0) {
                wrapper.innerHTML = '<div class="swiper-slide" style="color:white; font-size:24px;">upload 폴더에 01.png, 02.jpg 또는 03.mp4 등의 파일을 넣어주세요.</div>';
                return;
            }

            // setup.json에서 로드한 설정값 사용 (없으면 기본값)
            const config = swiperConfig || getDefaultConfig();

            // 디버깅: 로드된 config 상세 확인
            console.log('로드된 config 전체:', JSON.stringify(config, null, 2));
            console.log('config.autoplay:', config.autoplay);
            console.log('config.autoplay?.delay:', config.autoplay?.delay);

            // 기본 autoplay delay (이미지/GIF용) - setup.json에서 가져옴
            const defaultDelay = config.autoplay?.delay || 12000;
            
            // 디버깅: setup.json 적용 확인
            console.log('Swiper 설정 적용:', {
                delay: defaultDelay + 'ms',
                effect: config.effect,
                speed: config.speed,
                setupJsonLoaded: !!swiperConfig,
                configSource: swiperConfig ? 'setup.json' : '기본값',
                autoplayDelay: config.autoplay?.delay,
                autoplayObject: config.autoplay
            });

            // Swiper 옵션 구성
            const swiperOptions = {
                loop: config.loop !== undefined ? (count > 1 && config.loop) : (count > 1),
                effect: config.effect || 'fade',
                speed: config.speed || 1500,
                autoplay: {
                    delay: defaultDelay,
                    disableOnInteraction: config.autoplay?.disableOnInteraction !== undefined 
                        ? config.autoplay.disableOnInteraction 
                        : false,
                },
                pagination: {
                    el: ".swiper-pagination",
                    clickable: config.pagination?.clickable !== undefined 
                        ? config.pagination.clickable 
                        : true,
                },
                on: {
                    slideChange: function() {
                        lastSlideChangeTime = Date.now();
                        
                        // 6단계: Loop 모드 인덱스 불일치 방지
                        let currentIndex = this.realIndex;
                        
                        // 인덱스 유효성 검증
                        if (currentIndex < 0 || currentIndex >= slideMetadata.length) {
                            console.warn('인덱스 범위 초과, DOM에서 직접 확인:', currentIndex);
                            // DOM에서 직접 확인
                            const currentSlideElement = this.slides[this.activeIndex];
                            const hasVideo = currentSlideElement?.querySelector('video') !== null;
                            const hasImage = currentSlideElement?.querySelector('img') !== null;
                            
                            // 안전한 폴백: DOM에 따라 타입 판단
                            if (hasVideo) {
                                // 비디오로 처리
                                if (this.autoplay.running) {
                                    this.autoplay.stop();
                                }
                                const video = currentSlideElement.querySelector('video');
                                if (video) {
                                    video.currentTime = 0;
                                    playVideoWithRetry(video, 2);
                                }
                                return;
                            } else if (hasImage) {
                                // 이미지로 처리
                                if (!this.autoplay.running) {
                                    this.params.autoplay.delay = defaultDelay;
                                    this.autoplay.start();
                                }
                                return;
                            }
                            
                            // 메타데이터 재확인 시도
                            currentIndex = Math.max(0, Math.min(currentIndex, slideMetadata.length - 1));
                        }
                        
                        const currentSlide = slideMetadata[currentIndex];
                        
                        // 5단계: 리소스 최적화 - 보이지 않는 슬라이드의 비디오 일시정지
                        if (this.slides && this.slides.length > 0) {
                            this.slides.forEach((slide, idx) => {
                                if (idx !== this.activeIndex) {
                                    const video = slide.querySelector('video');
                                    if (video && !video.paused) {
                                        video.pause();
                                        video.currentTime = 0;
                                    }
                                }
                            });
                        }
                        
                        if (currentSlide) {
                            if (currentSlide.type === 'video') {
                                // 영상인 경우: autoplay 중지하고 영상 재생 완료까지 대기
                                if (this.autoplay.running) {
                                    this.autoplay.stop();
                                }
                                
                                // 현재 슬라이드의 video 요소 재생 시작
                                const currentSlideElement = this.slides[this.activeIndex];
                                const video = currentSlideElement.querySelector('video');
                                if (video) {
                                    video.currentTime = 0;
                                    
                                    // 기존 타임아웃 클리어
                                    if (videoPlayTimeout) {
                                        clearTimeout(videoPlayTimeout);
                                    }
                                    
                                    // 재생 시도 (재시도 로직 포함)
                                    playVideoWithRetry(video, 2).then(success => {
                                        if (!success && swiperInstance) {
                                            // 재생 실패 시 3초 후 다음 슬라이드로
                                            videoPlayTimeout = setTimeout(() => {
                                                console.warn('비디오 재생 실패로 인한 자동 넘김:', video.src);
                                                swiperInstance.slideNext();
                                            }, 3000);
                                        }
                                    });
                                    
                                    // 재생 상태 모니터링 (3초 내 재생 시작 안 되면 다음 슬라이드로)
                                    let playCheckCount = 0;
                                    const playCheckInterval = setInterval(() => {
                                        playCheckCount++;
                                        if (video.readyState >= 2 && !video.paused) {
                                            clearInterval(playCheckInterval);
                                        } else if (playCheckCount >= 6) { // 3초 (0.5초 * 6)
                                            clearInterval(playCheckInterval);
                                            if (video.paused && swiperInstance) {
                                                console.warn('비디오 재생 타임아웃, 다음 슬라이드로:', video.src);
                                                swiperInstance.slideNext();
                                            }
                                        }
                                    }, 500);
                                }
                            } else {
                                // 이미지/GIF인 경우: setup.json의 delay로 autoplay 재시작
                                // 클로저로 캡처한 defaultDelay 사용 (setup.json에서 가져온 값)
                                
                                // autoplay가 중지된 경우에만 재시작 (불필요한 stop/start 방지)
                                if (!this.autoplay.running) {
                                    this.params.autoplay.delay = defaultDelay;
                                    this.autoplay.start();
                                    console.log('이미지/GIF 슬라이드 - autoplay 재시작:', defaultDelay + 'ms');
                                } else if (this.params.autoplay.delay !== defaultDelay) {
                                    // delay만 변경 (이미 실행 중이면 stop/start 하지 않음)
                                    this.params.autoplay.delay = defaultDelay;
                                    this.autoplay.update(); // delay 업데이트만
                                    console.log('이미지/GIF 슬라이드 - autoplay delay 업데이트:', defaultDelay + 'ms');
                                }
                            }
                        }
                    }
                }
            };

            // fade 효과일 때만 fadeEffect 옵션 추가
            if (config.effect === 'fade' && config.fadeEffect) {
                swiperOptions.fadeEffect = config.fadeEffect;
            }

            swiperInstance = new Swiper(".mySwiper", swiperOptions);
            
            // 첫 번째 슬라이드가 영상인 경우 autoplay 중지
            if (slideMetadata.length > 0 && slideMetadata[0].type === 'video') {
                if (swiperInstance.autoplay.running) {
                    swiperInstance.autoplay.stop();
                }
                // 첫 번째 영상 재생 시작
                setTimeout(() => {
                    const firstSlideElement = swiperInstance.slides[swiperInstance.activeIndex];
                    const video = firstSlideElement?.querySelector('video');
                    if (video) {
                        playVideoWithRetry(video, 2).then(success => {
                            if (!success) {
                                console.warn('첫 번째 비디오 재생 실패, 다음 슬라이드로');
                                setTimeout(() => {
                                    if (swiperInstance) {
                                        swiperInstance.slideNext();
                                    }
                                }, 3000);
                            }
                        });
                    }
                }, 100);
            }
            
            // 2단계: autoplay 상태 모니터링 시작
            startAutoplayMonitor(defaultDelay);
            
            // 3단계: 슬라이드 변경 모니터링 시작
            startSlideChangeMonitor();
            
            // 4단계: 비디오 ended 이벤트 대체 감지 시작
            startVideoEndMonitor();
        }

        // 2단계: autoplay 상태 모니터링 함수
        function startAutoplayMonitor(defaultDelay) {
            if (autoplayMonitorInterval) {
                clearInterval(autoplayMonitorInterval);
            }
            
            autoplayMonitorInterval = setInterval(() => {
                if (!swiperInstance) return;
                
                const currentIndex = swiperInstance.realIndex;
                const currentSlide = slideMetadata[currentIndex];
                
                if (currentSlide && currentSlide.type === 'image') {
                    // 이미지 슬라이드인데 autoplay가 멈춰있으면 재시작
                    if (!swiperInstance.autoplay.running) {
                        console.warn('autoplay가 멈춰있음 감지, 재시작 시도');
                        swiperInstance.params.autoplay.delay = defaultDelay;
                        swiperInstance.autoplay.start();
                    }
                }
            }, 5000); // 5초마다 체크
        }

        // 3단계: 슬라이드 변경 모니터링 함수
        function startSlideChangeMonitor() {
            if (slideChangeMonitorInterval) {
                clearInterval(slideChangeMonitorInterval);
            }
            
            slideChangeMonitorInterval = setInterval(() => {
                if (!swiperInstance) return;
                
                const timeSinceLastChange = Date.now() - lastSlideChangeTime;
                
                // 30초 동안 슬라이드 변경이 없으면 강제 리셋
                if (timeSinceLastChange > 30000) {
                    console.error('슬라이드 장시간 멈춤 감지 (30초), 강제 리셋');
                    lastSlideChangeTime = Date.now();
                    
                    // 첫 슬라이드로 이동 후 재시작
                    swiperInstance.slideTo(0);
                    
                    // autoplay 재시작
                    const config = swiperConfig || getDefaultConfig();
                    const defaultDelay = config.autoplay?.delay || 12000;
                    swiperInstance.params.autoplay.delay = defaultDelay;
                    if (!swiperInstance.autoplay.running) {
                        swiperInstance.autoplay.start();
                    }
                    
                    // 첫 슬라이드가 비디오면 재생 시도
                    if (slideMetadata.length > 0 && slideMetadata[0].type === 'video') {
                        setTimeout(() => {
                            const firstSlideElement = swiperInstance.slides[swiperInstance.activeIndex];
                            const video = firstSlideElement?.querySelector('video');
                            if (video) {
                                playVideoWithRetry(video, 2);
                            }
                        }, 500);
                    }
                }
                // 15초 동안 슬라이드 변경이 없으면 강제로 다음 슬라이드로
                else if (timeSinceLastChange > 15000) {
                    console.warn('슬라이드 변경 없음 감지 (15초), 강제로 다음 슬라이드로 이동');
                    lastSlideChangeTime = Date.now();
                    swiperInstance.slideNext();
                }
            }, 5000); // 5초마다 체크
        }

        // 4단계: 비디오 ended 이벤트 대체 감지 함수
        function startVideoEndMonitor() {
            if (videoEndCheckInterval) {
                clearInterval(videoEndCheckInterval);
            }
            
            videoEndCheckInterval = setInterval(() => {
                if (!swiperInstance) return;
                
                const currentIndex = swiperInstance.realIndex;
                const currentSlide = slideMetadata[currentIndex];
                
                if (currentSlide && currentSlide.type === 'video') {
                    const currentSlideElement = swiperInstance.slides[swiperInstance.activeIndex];
                    const video = currentSlideElement?.querySelector('video');
                    
                    if (video && !video.paused) {
                        // 비디오가 재생 중일 때 currentTime과 duration 체크
                        const duration = video.duration || currentSlide.duration || 5;
                        const currentTime = video.currentTime || 0;
                        
                        // duration에 근접하면 (0.5초 이내) 완료로 간주
                        if (duration > 0 && currentTime >= duration - 0.5) {
                            console.log('비디오 재생 완료 감지 (timeupdate):', currentSlide.path);
                            if (swiperInstance) {
                                swiperInstance.slideNext();
                            }
                        }
                        
                        // 비디오 길이 + 1초 타임아웃 체크
                        const maxDuration = duration + 1;
                        if (currentTime >= maxDuration) {
                            console.warn('비디오 타임아웃, 다음 슬라이드로:', currentSlide.path);
                            if (swiperInstance) {
                                swiperInstance.slideNext();
                            }
                        }
                    }
                }
            }, 500); // 0.5초마다 체크
        }

        // 실행: setup.json 로드 후 이미지 로드 및 Swiper 초기화
        (async function init() {
            await loadSwiperConfig();
            await loadAndRenderPosters();
        })();

        // 7단계: 백그라운드/포커스 처리
        function handleVisibilityChange() {
            if (document.hidden) {
                console.log('페이지가 백그라운드로 전환됨');
                // 백그라운드로 전환 시 비디오 일시정지
                if (swiperInstance) {
                    const currentSlideElement = swiperInstance.slides[swiperInstance.activeIndex];
                    const video = currentSlideElement?.querySelector('video');
                    if (video && !video.paused) {
                        video.pause();
                    }
                }
            } else {
                console.log('페이지가 포그라운드로 복귀함');
                // 포그라운드 복귀 시 현재 슬라이드 타입에 따라 재시작
                if (swiperInstance) {
                    const currentIndex = swiperInstance.realIndex;
                    const currentSlide = slideMetadata[currentIndex];
                    
                    if (currentSlide) {
                        if (currentSlide.type === 'video') {
                            // 비디오 재생 재시도
                            const currentSlideElement = swiperInstance.slides[swiperInstance.activeIndex];
                            const video = currentSlideElement?.querySelector('video');
                            if (video) {
                                playVideoWithRetry(video, 2);
                            }
                        } else {
                            // 이미지면 autoplay 재시작
                            if (!swiperInstance.autoplay.running) {
                                const config = swiperConfig || getDefaultConfig();
                                const defaultDelay = config.autoplay?.delay || 12000;
                                swiperInstance.params.autoplay.delay = defaultDelay;
                                swiperInstance.autoplay.start();
                            }
                        }
                    }
                }
            }
        }
        
        document.addEventListener('visibilitychange', handleVisibilityChange);
        window.addEventListener('focus', handleVisibilityChange);
        window.addEventListener('blur', () => {
            if (swiperInstance) {
                const currentSlideElement = swiperInstance.slides[swiperInstance.activeIndex];
                const video = currentSlideElement?.querySelector('video');
                if (video && !video.paused) {
                    video.pause();
                }
            }
        });

        // 키오스크 전용: 우클릭, 드래그, 선택 방지
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('dragstart', e => e.preventDefault());
        document.addEventListener('selectstart', e => e.preventDefault());
    </script>
</body>
</html>
